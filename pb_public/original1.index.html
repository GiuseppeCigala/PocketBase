<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Soggetti</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
        <script src='/js/pocketbase.umd.js'></script>
        <script src='/js/soggetti.js'></script>
    </head>

    <body>
        <main class="lg:mt-12" x-data="tableData()" x-init="pageCount = 1; fetchTableRows()">
            <section class="container mx-auto p-8 m-6 bg-gray-700 rounded-xl shadow-md">
                <h1 class="text-md lg:text-4xl font-bold text-white">Soggetti di Interesse Operativo</h1>
                <h2 class="text-md lg:text-2xl text-gray-400">Reparto Operativo - Nucleo Informativo</h2>
            </section>
            <section class="container mx-auto p-4 m-6 bg-gray-200 rounded-xl shadow-md">
                <div class="grid grid-cols-4">
                    <div class="px-4 col-span-3" @keydown.escape="showModal = false">
                        <button class="p-2 m-1 text-sm rounded shadow bg-green-200 hover:bg-green-400 text-slate-800"
                            type="button" @click="showModal = true; editModal = false; resetForm()">Aggiungi
                            soggetto</button>
                    </div>
                    <div class="px-4">
                        <div class="input-group flex">
                            <input type="search" x-ref="searchField" x-model="search"
                                x-on:keydown.window.prevent.slash="$refs.searchField.focus()" placeholder="Cerca..."
                                class="form-control relative flex-auto min-w-0 block w-full px-3 py-2 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-gray-400 focus:outline-none"
                                placeholder="Search" aria-label="Search" aria-describedby="button-addon2">
                        </div>
                    </div>
                </div>
            </section>
            <!-- Table -->
            <section class="container mx-auto p-8 m-6 bg-gray-50 rounded-xl shadow-md">
                <table class="w-full text-base text-center text-gray-500">
                    <thead class="text-base text-gray-800 uppercase bg-gray-300">
                        <tr>
                            <th scope="col" class="p-4 border">
                                Foto
                            </th>
                            <th scope="col" class="p-4 border">
                                Generalita'
                            </th>
                            <th scope="col" class="p-4 border">
                                Area
                            </th>
                            <th scope="col" class="p-4 border">
                                Note
                            </th>
                            <th scope="col" class="p-4 border">
                                Azioni
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="soggetto in filteredSoggetti">
                            <tr class="bg-white">
                                <td class="p-4 border">
                                    <template x-if="soggetto.foto"><a
                                            x-bind:href="'api/files/' + collection + '/' + soggetto.id + '/' + soggetto.foto"
                                            target="_blank">
                                            <img :src="'api/files/' + collection + '/' + soggetto.id + '/' + soggetto.foto + '?thumb=100x100'"
                                                class="rounded-md shadow" alt=""></a></template>
                                </td>
                                <td class="p-4 border" x-text="soggetto.generalita"></td>
                                <td class="p-4 border" x-text="soggetto.area"></td>
                                <td class="p-4 border" x-text="soggetto.note"></td>
                                <td class="p-4 border"><button
                                        class="p-2 m-1 text-sm rounded shadow bg-green-200 hover:bg-green-400 text-slate-800"
                                        @keydown.escape="showModal = false"
                                        @click="showModal = true; editModal = true; loadRow(soggetto.id)">Modifica</button><button
                                        class="p-2 m-1 text-sm rounded shadow bg-red-200 hover:bg-red-400 text-slate-800"
                                        @click="deleteRow(soggetto.id)">Cancella</button></td>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </section>
            <!-- Modal -->
            <section>
                <div class="fixed inset-0 z-30 flex items-center justify-center overflow-auto bg-black bg-opacity-50"
                    x-show="showModal" @submit.prevent="submitData">
                    <!-- Modal inner -->
                    <div class="px-6 py-4 mx-auto w-96 text-left bg-white rounded shadow-lg"
                        @click.away="showModal = false" x-transition:enter="motion-safe:ease-out duration-300"
                        x-transition:enter-start="opacity-0 scale-90" x-transition:enter-end="opacity-100 scale-100">
                        <!-- Title -->
                        <div class="flex items-center justify-between">
                            <template x-if="!editModal">
                                <div class="self-center text-base sm:text-2xl text-gray-400 pb-4">
                                    Aggiungi soggetto
                                </div>
                            </template>
                            <template x-if="editModal">
                                <div class="self-center text-base sm:text-2xl text-gray-400 pb-4">
                                    Modifica soggetto
                                </div>
                            </template>
                        </div>
                        <hr class="p-2">
                        <!-- Content -->
                        <div>
                            <form x-ref="form">
                                <div class="grid gap-6 mb-6">
                                    <div>
                                        <label for="Generalita"
                                            class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Generalita'</label>
                                        <input type="text" x-model="generalita"
                                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                                            placeholder="" required>
                                    </div>
                                    <div>
                                        <label for="Area"
                                            class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Area</label>
                                        <input type="text" x-model="area"
                                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                                            placeholder="" required>
                                    </div>
                                    <div>
                                        <label for="Note"
                                            class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Note</label>
                                        <textarea type="text" x-model="note"
                                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                                            placeholder=""></textarea>
                                    </div>
                                    <div>
                                        <div class="mb-2">
                                            <label for="Foto"
                                                class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Foto</label>
                                            <!-- Show the image -->
                                            <template x-if="foto">
                                                <img :src="foto" class="object-cover rounded border border-gray-200"
                                                    style="width: 100px; height: 100px;">
                                            </template>
                                            <!-- Show the gray box when image is not available -->
                                            <template x-if="!foto">
                                                <div class="border rounded border-gray-200 bg-gray-100"
                                                    style="width: 100px; height: 100px;"></div>
                                            </template>
                                            <!-- Image file selector -->
                                            <input class="mt-2" type="file" accept="image/*" x-ref="inputFile"
                                                @change="fileChosen">
                                        </div>
                                    </div>
                                </div>
                                <hr class="p-2">
                                <div class="grid grid-cols-2 gap-4">
                                    <button type="button"
                                        class="p-2 m-1 text-sm rounded shadow bg-red-200 hover:bg-red-400 text-slate-800"
                                        @click="showModal = false">Chiudi</button>
                                    <button type="submit"
                                        class="p-2 m-1 text-sm rounded shadow bg-green-200 hover:bg-green-400 text-slate-800"
                                        @click="showModal = false">Salva</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
            <section class="container mx-auto p-4 m-6 bg-gray-200 rounded-xl shadow-md">
                <div class="inline-flex mt-2 xs:mt-0 items-center">
                        <button class="p-2 m-1 text-sm rounded shadow bg-green-200 hover:bg-green-400 text-slate-800" x-on:click="pageCount = pageCount > 1 ? pageCount-1 : pageCount">Prev</button>
                        <span x-text="pageCount"></span>
                        <button class="p-2 m-1 text-sm rounded shadow bg-green-200 hover:bg-green-400 text-slate-800" x-on:click="pageCount++">Next</button>
                </div>
            </section>
        </main>
    </body>

</html>